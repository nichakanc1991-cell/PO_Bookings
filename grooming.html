<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PO Grooming ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --po-deep:#0b3d36;
      --po-forest:#1c322d;
      --po-olive:#324f44;
      --po-card:#f6f9f7;
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-[var(--po-deep)] to-[#f8f4e7]">

<main class="max-w-5xl mx-auto p-4">

  <!-- HEADER -->
  <header class="flex items-center justify-between bg-white/70 p-4 rounded-xl shadow mb-4">
    <h1 class="text-xl font-bold text-[var(--po-forest)]">üêæ PO Grooming ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</h1>
    <a class="text-indigo-700 underline" target="_blank"
       href="https://docs.google.com/spreadsheets/d/1xhS3Yl5BpTkTSjEKT_nMM6G7qgCf7-m7vkFZjiWaGmE/edit#gid=0">
       ‡πÄ‡∏õ‡∏¥‡∏î Google Sheet
    </a>
  </header>

  <!-- STEP 1 -->
  <section class="grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-4">
    <div class="bg-white/80 p-4 rounded-xl shadow">
      <div id="calendarDays" class="grid grid-cols-3 gap-2"></div>

      <div id="calendarTimes" class="mt-4 grid grid-cols-3 gap-2"></div>
    </div>

    <div class="bg-white/80 p-4 rounded-xl shadow">
      <h3 class="font-bold mb-2 text-[var(--po-forest)]">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</h3>
      <ol class="text-sm space-y-2">
        <li>1) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤</li>
        <li>2) ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ & ‡πÄ‡∏ö‡∏≠‡∏£‡πå</li>
        <li>3) ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ô‡πâ‡∏≠‡∏á</li>
        <li>4) ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</li>
        <li>5) ‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ & ‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏•‡∏¥‡∏õ</li>
      </ol>
    </div>
  </section>

  <!-- STEP 2 -->
  <section id="step2" class="hidden bg-white/80 p-4 rounded-xl shadow mt-4">
    <h3 class="font-bold text-[var(--po-forest)] mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</h3>
    <input id="custName" class="w-full border p-2 rounded mb-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á" />
    <input id="custPhone" class="w-full border p-2 rounded mb-2" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" />

    <button onclick="goToPets()"
            class="w-full bg-[var(--po-olive)] text-white p-2 rounded">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
  </section>

  <!-- STEP 3 -->
  <section id="step3" class="hidden bg-white/80 p-4 rounded-xl shadow mt-4">
    <h3 class="font-bold text-[var(--po-forest)]">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ô‡πâ‡∏≠‡∏á</h3>

    <div id="petsContainer" class="space-y-4 mt-3"></div>

    <button id="addPet" class="px-3 py-2 rounded border">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß</button>
    <button onclick="goToSummary()" class="px-3 py-2 float-right rounded bg-indigo-600 text-white">
      ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
    </button>
    <div class="clear-both"></div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ -->
    <div id="priceCat" class="hidden mt-4">
      <img src="./price-cat.png" class="rounded-lg shadow border" />
    </div>
    <div id="priceDog" class="hidden mt-4">
      <img src="./price-dog.png" class="rounded-lg shadow border" />
    </div>
    <div id="priceOption" class="hidden mt-4">
      <img src="./option.png" class="rounded-lg shadow border" />
    </div>
  </section>

  <!-- STEP 4 -->
  <section id="step4" class="hidden bg-white/80 p-4 rounded-xl shadow mt-4">
    <h3 class="font-bold text-[var(--po-forest)]">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>

    <div id="summary" class="mt-3 text-sm"></div>

    <button onclick="goToPayment()"
            class="w-full bg-indigo-600 text-white p-2 rounded mt-3">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
  </section>

  <!-- STEP 5 -->
  <section id="step5" class="hidden bg-white/80 p-4 rounded-xl shadow mt-4">
    <h3 class="font-bold text-[var(--po-forest)] mb-2">‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥</h3>
    <img src="./qr.png" class="rounded-lg border shadow w-full max-w-[360px] mx-auto" />

    <button onclick="sendToLINE()" class="w-full mt-3 bg-green-600 text-white p-3 rounded">
      ‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏≤‡∏á‡πÑ‡∏•‡∏ô‡πå
    </button>
  </section>

</main>


<!-- ---------------------------------------------------
     JAVASCRIPT
--------------------------------------------------- -->

<script>
// ------------------------------------------------------
// CONFIG
// ------------------------------------------------------
const SHEET_URL =
  "https://docs.google.com/spreadsheets/d/1xhS3Yl5BpTkTSjEKT_nMM6G7qgCf7-m7vkFZjiWaGmE/gviz/tq?tqx=out:json&gid=0";

const TIME_SLOTS = ["12:00","14:00","15:00","16:00","17:00","18:00"];

const SERVICE_DURATION = { bath:2, cutonly:2, bathcut:3 };

let calendarData = [];
let selectedDate = null;
let selectedTime = null;

let petCount = 0;
let pets = [];


// ------------------------------------------------------
// LOAD SHEET
// ------------------------------------------------------
async function loadCalendar() {
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  const json = JSON.parse(text.substring(47, text.length - 2));

  calendarData = json.table.rows.map(r => ({
    date: r.c[0]?.v,
    time: r.c[1]?.v,
    status: r.c[2]?.v === true
  }));
}


// ------------------------------------------------------
// RENDER DAYS
// ------------------------------------------------------
function renderCalendarDays() {
  const box = document.getElementById("calendarDays");
  box.innerHTML = "";

  let dates = [...new Set(calendarData.map(r => r.date))];

  dates.forEach(d => {
    const btn = document.createElement("button");
    btn.className = "p-3 bg-white rounded-xl hover:bg-yellow-200";
    btn.innerText = d;
    btn.onclick = () => selectDate(d);
    box.appendChild(btn);
  });
}


// ------------------------------------------------------
// SELECT DATE
// ------------------------------------------------------
function selectDate(d) {
  selectedDate = d;
  selectedTime = null;
  document.getElementById("calendarTimes").innerHTML = "";
  document.getElementById("step2").classList.add("hidden");
  renderTimesForDate(d);
}


// ------------------------------------------------------
// TIME RULES
// ------------------------------------------------------
function isValidTime(slot) {
  let errors = [];

  for (let i=1; i<=petCount; i++) {
    let type = document.getElementById(`petType-${i}`).value;
    let svc  = document.getElementById(`service-${i}`).value;

    // 12:00 ‡∏´‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    if (slot === "12:00" && type !== "dog") {
      errors.push("‡πÄ‡∏ß‡∏•‡∏≤ 12:00 ‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏Ñ‡πà‡∏∞");
    }

    // 18:00 ‡∏´‡πâ‡∏≤‡∏° bathcut
    if (slot === "18:00" && svc === "bathcut") {
      errors.push("18:00 ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏Ç‡∏ô‡∏Ñ‡πà‡∏∞");
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠ (duration)
    let dur = SERVICE_DURATION[svc];
    if (dur) {
      let start = TIME_SLOTS.indexOf(slot);
      for (let k=1; k<dur; k++) {
        let next = TIME_SLOTS[start + k];
        let row = calendarData.find(r => r.date===selectedDate && r.time===next);
        if (!row?.status) {
          errors.push(`${slot} ‚Üí ${next} ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á`);
        }
      }
    }
  }

  if (errors.length > 0) {
    alert(errors.join("\n"));
    return false;
  }
  return true;
}


// ------------------------------------------------------
// RENDER TIME BUTTONS
// ------------------------------------------------------
function renderTimesForDate(date) {
  const box = document.getElementById("calendarTimes");
  box.innerHTML = "";

  TIME_SLOTS.forEach(slot => {
    const row = calendarData.find(r => r.date === date && r.time === slot);
    const free = row?.status;

    const btn = document.createElement("button");
    btn.innerText = slot;
    btn.className = "p-3 rounded-xl w-full " +
      (free ? "bg-white hover:bg-yellow-200" : "bg-gray-300 text-gray-600");
    btn.disabled = !free;

    if (free) btn.onclick = () => selectTime(slot);

    box.appendChild(btn);
  });
}


// ------------------------------------------------------
// SELECT TIME
// ------------------------------------------------------
function selectTime(slot) {
  if (!isValidTime(slot)) return;

  selectedTime = slot;

  document.getElementById("step2").classList.remove("hidden");
}


// ------------------------------------------------------
// STEP 2 ‚Üí STEP 3
// ------------------------------------------------------
function goToPets() {
  let n = document.getElementById("custName").value.trim();
  let p = document.getElementById("custPhone").value.trim();

  if (!n || !p) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

  document.getElementById("step3").classList.remove("hidden");
  addPet();
}


// ------------------------------------------------------
// ADD PET FORM
// ------------------------------------------------------
function addPet() {
  petCount++;
  if (petCount > 3) return;

  const wrap = document.createElement("div");
  wrap.className = "p-3 border rounded-xl";
  wrap.innerHTML = `
    <p class="font-bold mb-2">‡∏ô‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà ${petCount}</p>

    <label class="text-sm">‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå *</label>
    <select id="petType-${petCount}" onchange="showPrice(${petCount})"
      class="border w-full p-2 rounded mb-2">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
      <option value="dog">‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</option>
      <option value="cat">‡πÅ‡∏°‡∏ß</option>
    </select>

    <label class="text-sm">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å *</label>
    <select id="weight-${petCount}" class="border w-full p-2 rounded mb-2">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</option>
      <option value="s">‡πÄ‡∏•‡πá‡∏Å</option>
      <option value="m">‡∏Å‡∏•‡∏≤‡∏á</option>
      <option value="l">‡πÉ‡∏´‡∏ç‡πà</option>
      <option value="xl">‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å (XL)</option>
    </select>

    <label class="text-sm">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏ô *</label>
    <select id="hair-${petCount}" class="border w-full p-2 rounded mb-2">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
      <option value="short">‡∏Ç‡∏ô‡∏™‡∏±‡πâ‡∏ô</option>
      <option value="medium">‡∏Ç‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
      <option value="long">‡∏Ç‡∏ô‡∏¢‡∏≤‡∏ß</option>
    </select>

    <label class="text-sm">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ *</label>
    <select id="service-${petCount}" class="border w-full p-2 rounded mb-2">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</option>
      <option value="bath">‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥</option>
      <option value="cutonly">‡∏ï‡∏±‡∏î‡∏Ç‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</option>
      <option value="bathcut">‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏Ç‡∏ô</option>
    </select>
  `;
  pets.push(wrap);
  document.getElementById("petsContainer").appendChild(wrap);
}


// ------------------------------------------------------
// SHOW PRICE IMAGES
// ------------------------------------------------------
function showPrice(i) {
  const type = document.getElementById(`petType-${i}`).value;

  document.getElementById("priceCat").classList.add("hidden");
  document.getElementById("priceDog").classList.add("hidden");
  document.getElementById("priceOption").classList.add("hidden");

  if (type === "cat") {
    priceCat.classList.remove("hidden");
    priceOption.classList.remove("hidden");
  }
  if (type === "dog") {
    priceDog.classList.remove("hidden");
    priceOption.classList.remove("hidden");
  }
}


// ------------------------------------------------------
// STEP 3 ‚Üí STEP 4 SUMMARY
// ------------------------------------------------------
function goToSummary() {
  const box = document.getElementById("summary");
  let dep = calcDeposit();

  box.innerHTML = `
    <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <b>${selectedDate}</b></p>
    <p>‡πÄ‡∏ß‡∏•‡∏≤: <b>${selectedTime}</b></p>
    <hr class="my-2" />
    <p>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏£‡∏ß‡∏°: <b>${dep} ‡∏ö‡∏≤‡∏ó</b></p>
  `;

  document.getElementById("step4").classList.remove("hidden");
}


// ------------------------------------------------------
// DEPOSIT
// ------------------------------------------------------
function calcDeposit() {
  let sum = 0;

  for (let i=1; i<=petCount; i++) {
    let type = document.getElementById(`petType-${i}`).value;
    let svc = document.getElementById(`service-${i}`).value;
    let w = document.getElementById(`weight-${i}`).value;

    if (type === "dog" && w === "xl") {
      sum += 400;
      continue;
    }
    if (svc === "bath") sum += 200;
    if (svc === "cutonly") sum += 200;
    if (svc === "bathcut") sum += 400;
  }
  return sum;
}


// ------------------------------------------------------
// STEP 5
// ------------------------------------------------------
function goToPayment() {
  document.getElementById("step5").classList.remove("hidden");
}


// ------------------------------------------------------
// SEND TO LINE
// ------------------------------------------------------
function sendToLINE() {
  let text = "üìå ‡πÅ‡∏à‡πâ‡∏á‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£\n\n";
  text += `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${selectedDate}\n‡πÄ‡∏ß‡∏•‡∏≤: ${selectedTime}\n\n`;

  for (let i=1; i<=petCount; i++) {
    text += `‡∏ô‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà ${i}:\n`;
    text += `‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏±‡∏ï‡∏ß‡πå: ${document.getElementById(`petType-${i}`).value}\n`;
    text += `‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: ${document.getElementById(`weight-${i}`).value}\n`;
    text += `‡∏Ç‡∏ô: ${document.getElementById(`hair-${i}`).value}\n`;
    text += `‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ${document.getElementById(`service-${i}`).value}\n\n`;
  }

  text += `‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏£‡∏ß‡∏°: ${calcDeposit()} ‡∏ö‡∏≤‡∏ó\n`;
  text += `\n‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° + ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏Ñ‡πà‡∏∞ üíõ`;

  let url = `https://line.me/R/ti/p/@POGROOMING?text=${encodeURIComponent(text)}`;
  window.location.href = url;
}


// ------------------------------------------------------
// INIT
// ------------------------------------------------------
document.addEventListener("DOMContentLoaded", async () => {
  await loadCalendar();
  renderCalendarDays();

  document.getElementById("addPet").onclick = () => addPet();
});
</script>

</body>
</html>
